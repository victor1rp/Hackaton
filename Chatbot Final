
import pandas as pd
from sklearn.svm import SVC
from sklearn.feature_extraction.text import CountVectorizer
import time



# importing data set
questions = pd.read_excel(r'C:/Users/Admin/Desktop/Date_base_Bol_2.1.xlsx')

#cleaning data
questions = questions.fillna('')

# converting text data to numerical data
vectorizer = CountVectorizer()
x_train = vectorizer.fit_transform(questions['Question'])
y_train = questions['Intent']
z_train = questions['Problem']

# training SVM model
clf = SVC(C=1)
clf.fit(x_train, y_train)

#Catogorizing problem
clf_2 = SVC(C=1)
clf_2.fit(x_train, z_train)

#Message input
txt = 'Hey there ! What can I help you with today? You: '
for i in txt:  # этот цикл будет брать по 1 буковке из тхт
    time.sleep(0.1)
    print(i, end='', flush=True)
message_1 = input()

#message prediction intent
message_1_transformed = vectorizer.transform([message_1])
message_1_pred = clf.predict(message_1_transformed)

#message prediction problem
message_1_transformed_problem = vectorizer.transform([message_1])
message_1_pred_problem= clf_2.predict(message_1_transformed_problem)

#Creating the libraries
order = {
    'Website issue': ' That is annoying and I am sorry about that. Let me inform our IT department. If in case you do not see any changes within 24 hours kindly contact us for further assistance. +31 4529 25617',
    'Cancellation issue': ' Not to worry, I have informed our customer support team and they will call you tomorrow any time between 13:00 - 17:00 to fix the issue at hand',
    'Payment issue': ' No worries ! You will still recieve your package. We will send you a seperate email with payment detials shortly',
    'No payment confirmation': ' Sorry about that ! We will send you payment confirmation within the next hour to your gmail address'
}
  
delivery = {
    'Delivery to wrong location': ' I can only imagine how annoying that must be. It appears that our third party delivery service made a mistake. The best way to solve the issue would be to contact them : + 31 5739 56713. They will help you out immediately.',
    'Package is late ': ' Sorry to hear that, I am on it ! It appears your package is on route to your address.Our third party delvery team is having a few issues at the moment. Kindly wait three days from now and your package should be delivered anytime between 13:00 -17:00. If in case you do not recieve your package by then kindly call this number : +31 4537 56189',
    'Package is lost': ' Not on my watch ! It appears that your package is not lost, our website is currently displaying the wrong message which we will fix. Your package will be delivered tomorrow anytime between 13:00 - 17:00',
    'Order status is wrong': ' Ahh that is a shame, I will inform our IT team and it will be fixed by tomorrow!'
}
  
receiving = {
    'Delivery man issue': ' I am sorry he stole your cat, I will steal his sister for you do not worry',
    'Wrong package': ' Do not worry we will send you a new package tomorrow free of charge. It should be delivered to you anytime between 13:00 - 17:00',
    'Package is broken': ' I am sorry about that, it is a shame. Do not worry we will send you a new package tomorrow free of charge. It should be delivered to you anytime between 13:00 - 17:00'
}

returning = {
    'Money issue': ' Not to worry, kindly contact our customer help team at this number : +31 4573 26483, they are waiting for you !',
    'Can not find return info': ' Kindly refer to our website by clicking this link',
    'Warrant issue': ' You disgust me, I do not talk to criminals. I cancel you, you potato head',
}

errors = {
    'order': order,
    'delivery': delivery,
    'receiving': receiving,
    'returning': returning
}
  
errors_keys = errors.keys()
 

x = message_1_pred[0]
y = message_1_pred_problem[0]

#The conversation
if x in errors_keys:
    dict = eval(x)
    specific_errors_keys = dict.keys()
    if y in specific_errors_keys:
        time.sleep(0.5)
        txt1 = 'It seems to me that your problem falls under: ' + x + ': And your specific issue is: ' + y + "."
        for i in txt1:  
            time.sleep(0.1)
            print(i, end='', flush=True)
        time.sleep(1)
        txt2 = ' Is this your specific problem? You: '
        for i in txt2:  
            time.sleep(0.1)
            print(i, end='', flush=True)
        test = input ()
        print(test)
        if test == 'Yes' or test == 'yes':
                time.sleep(0.5)
                txt3 = 'SOLVING:' + dict[y]
                for i in txt3:  
                    time.sleep(0.1)
                    print(i, end='', flush=True)
        else:
            time.sleep(0.5)
            txt4 = 'Sorry but I did not understand you, could you help me by picking the right issue below?' + x
            for i in txt4:  
                time.sleep(0.1)
                print(i, end='', flush=True)
            time.sleep(0.5)
            txt5 = ' List of possible problems:'
            for i in txt5:  
                time.sleep(0.1)
                print(i, end='', flush=True)
            i = 0
            for error in specific_errors_keys:
                time.sleep(0.5)
                print('№', i+1, '. ', error, sep="")
                i += 1
            txt6 = 'Choose number of specific problem (If your problem is not an option rerun the code and rephrase): '
            for i in txt6:  
                time.sleep(0.1)
                print(i, end='', flush=True)
            spefic_error_key = int(input())
            specific_error = list(delivery.keys())[spefic_error_key-1]
            solving = list(delivery.values())[spefic_error_key-1]
            time.sleep(0.5)
            txt7 = 'ERROR: ' + x + ': ' + specific_error
            for i in txt7:  
                time.sleep(0.1)
                print(i, end='', flush=True)
            time.sleep(0.5)
            for i in solving:  
                time.sleep(0.1)
                print(i, end='', flush=True)
        txt8 = ' Does this solve your problem? You:'
        for i in txt8:  
            time.sleep(0.1)
            print(i, end='', flush=True)
        b = input()
        if b == 'Yes' or b == 'yes':
            time.sleep(0.5)
            txt9 = 'I am always here to help you! Have a great day! <3'
            for i in txt9:  
                time.sleep(0.1)
                print(i, end='', flush=True)
        else:
            time.sleep(0.5)
            txt10 = 'I am sorry, but i can not solve all problems yet ;( We are working on ChatBot functionality! Please call: 0615066431 for better assistance'
            for i in txt10:  
                time.sleep(0.1)
                print(i, end='', flush=True)

    else:
        time.sleep(0.5)
        txt11 = 'Please rephrase your problem'
        for i in txt11:  
            time.sleep(0.1)
            print(i, end='', flush=True)

